<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="shortcut icon" href="images/favicon.jfif">

  <title>HN ENTERPRISE</title>
    <style>
      :root{ --indigo:#4f46e5; --purple:#7c3aed; --yellow:#f59e0b; --bg:#f3f4f6; --card:#fff; --muted:#6b7280; --maxw:1100px; }
      *{box-sizing:border-box}
      body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; background:var(--bg); color:#0b1220}
      .container{max-width:var(--maxw);margin:0 auto;padding:12px}
      header{background:var(--card); box-shadow:0 1px 0 rgba(0,0,0,.06); position:sticky; top:0; z-index:40}
      .top{display:flex;gap:12px;align-items:center;justify-content:space-between}
      .brand{font-weight:800;color:var(--indigo)}
      .search{display:flex;gap:8px;flex:1;margin-left:18px}
      .search input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid #e6e6e6}
      .btn{background:var(--indigo);color:white;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
      .flash{display:none;max-width:var(--maxw);margin:12px auto;padding:12px;background:#fffbeb;border-left:4px solid var(--yellow);border-radius:8px;color:#92400e}
      .deal{max-width:var(--maxw);margin:18px auto;background:linear-gradient(90deg,var(--indigo),var(--purple));color:white;padding:18px;border-radius:12px;display:flex;gap:16px;align-items:center}
      .deal .left{flex:1}
      .deal .thumb{width:240px;height:160px;border-radius:8px;overflow:hidden;background:#fff}
      .deal .thumb img{width:100%;height:100%;object-fit:cover;display:block}
      .dots{display:flex;gap:8px;margin-top:10px}
      .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.35);cursor:pointer;border:0}
      .dot.active{background:white;transform:scale(1.15)}
      main{padding:12px}
      .grid{max-width:var(--maxw);margin:18px auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
      .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(17,24,39,0.06);display:flex;flex-direction:column}
      .card img{width:100%;height:150px;object-fit:cover;border-radius:8px;cursor:pointer}
      .title{font-weight:700;margin-top:8px;cursor:pointer}
      .desc{color:var(--muted);font-size:13px;margin-top:6px}
      .price{margin-top:8px;font-weight:800}
      .meta{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
      .cart-btn{background:var(--yellow);border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
      .backdrop{display:none;position:fixed;inset:0;background:rgba(2,6,23,0.45);align-items:center;justify-content:center;z-index:60}
      .modal{background:var(--card);width:min(760px,96%);border-radius:12px;padding:16px;max-height:90vh;overflow:auto}
      .modal img{width:100%;height:320px;object-fit:cover;border-radius:8px}
      .flex{display:flex;gap:12px;align-items:center}
      footer{text-align:center;margin:24px auto;color:var(--muted)}

      /* New product form styles */
      .panel{max-width:var(--maxw);margin:18px auto;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(17,24,39,0.04)}
      .form-row{display:flex;gap:8px;align-items:center}
      .form-row input, .form-row textarea{flex:1;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
      .small{width:120px}
      .field { display:flex; flex-direction:column; gap:6px; width:100%; }
      .error { color:#b91c1c; font-size:12px; min-height:16px }
      .has-error input, .has-error textarea { border-color:#fca5a5; box-shadow:0 0 0 3px rgba(254,202,202,0.15); }
      .muted-help { font-size:12px; color:var(--muted) }

      @media(max-width:720px){ .deal{flex-direction:column;align-items:flex-start}.deal .thumb{width:100%;height:180px} .form-row{flex-direction:column;align-items:stretch} }
    </style>
</head>
<body>
  <header>
    <div class="container top">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="brand"><img src="images/favicon.jfif" style="height: 100px; width: 200px;"></div>
        <i><h1 style="color: blue;">HN ENTERPRISE</h1></i>
        <div class="search">
          <input id="searchInput" placeholder="Search products...">
          <button id="searchBtn" class="btn">Search</button>
        </div>
      </div>
      <div>
        <button id="openCartBtn" class="cart-btn">Cart (<span id="cartCount">0</span>)</button>
      </div>
    </div>
  </header>

  <div id="flash" class="flash">⚡ Flash sale: Extra 10% off featured item!</div>

  <section class="deal">
    <div class="left">
      <h2 style="color: goldenrod;">UNITED KINGDOM</h2>
      <div style="font-weight:900;font-size:18px" id="dealTitle">Limited Time Deal</div>
      <div style="opacity:.95;margin-top:6px">Selected items — hurry before it ends!</div>
      <div style="margin-top:10px" class="flex">
        <div id="countdown" style="font-family:monospace;font-size:18px;background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:8px">02:00</div>
        <div>
          <button id="shopNow" class="btn" style="margin-left:8px">Shop Now</button>
          <button id="pauseBtn" class="btn" style="margin-left:8px;background:rgba(255,255,255,0.12)">Pause</button>
        </div>
      </div>
      <div class="dots" id="dots"></div>
    </div>
    <div class="thumb"><img id="featuredImg" alt="featured"/></div>
  </section>

  <main>
    <center><h3 style="color:var(--muted);max-width:var(--maxw);margin:8px auto 0;padding:0 12px">Recommended for you</h3>
    <div id="productGrid" class="grid"></div>
      

    <h3 style="color:var(--muted);max-width:var(--maxw);margin:18px auto 0;padding:0 12px">New Arrivals</h3>
    <div id="newGrid" class="grid"></div>

    <!-- STATIC NEW PRODUCTS (same format as main products) -->
    <h3 style="color:var(--muted);max-width:var(--maxw);margin:18px auto 0;padding:0 12px">New Products (Static)</h3>
    <div id="staticNewGrid" class="grid"></div>

    
    <!-- NEW PRODUCTS PANEL MOVED TO BOTTOM -->
    <div class="panel">
      <h3>Add New Product</h3>
      <!-- We'll wrap each input in a field container to show errors -->
      <div style="margin-top:8px" class="form-row">
        <div class="field" style="flex:2">
          <input id="newTitle" placeholder="Product title" aria-describedby="errTitle" />
          <div id="errTitle" class="error"></div>
        </div>
        <div class="field" style="flex:0 0 120px">
          <input id="newPrice" class="small" placeholder="Price" aria-describedby="errPrice" />
          <div id="errPrice" class="error"></div>
        </div>
      </div>
      <div style="margin-top:8px" class="form-row">
        <div class="field">
          <input id="newImg" placeholder="Image URL (optional)" aria-describedby="errImg" />
          <div id="errImg" class="error"></div>
          <div class="muted-help">Leave blank to use a placeholder image</div>
        </div>
        <div class="field" style="flex:0 0 220px">
          <input id="newShort" placeholder="Short desc (optional, max 80 chars)" aria-describedby="errShort" />
          <div id="errShort" class="error"></div>
        </div>
      </div>
      <div style="margin-top:8px" class="form-row">
        <div class="field" style="width:100%">
          <textarea id="newDesc" placeholder="Long description (optional)" rows="2" aria-describedby="errDesc"></textarea>
          <div id="errDesc" class="error"></div>
        </div>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
        <button id="addNewBtn" class="btn" disabled>Add to New Products</button>
        <button id="clearNewBtn" class="btn" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Clear</button>
      </div>
    </div>
    </center>
</main>

  <center><h2 style="color: rgb(68, 20, 201);">Thank You for Orders</h2></center>

  <footer>Built with ❤️ — Images update demo</footer>

  <!-- CART MODAL -->
  <div id="cartBackdrop" class="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="cartModal">
      <h3>Your Cart</h3>
      <div id="cartItems" style="margin-top:12px"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div id="cartTotal" style="font-weight:800">Total: $0.00</div>
        <div>
          <button id="closeCart" class="btn" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Close</button>
          <button id="checkoutBtn" class="btn">Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DETAIL MODAL -->
  <div id="detailBackdrop" class="backdrop" aria-hidden="true">
    <div class="modal" id="detailModal">
      <h3 id="detailTitle">Product</h3>
      <img id="detailImg" src="" alt="product detail"/>
      <div id="detailPrice" style="font-weight:800;margin-top:8px"></div>
      <div id="detailDesc" style="color:var(--muted);margin-top:8px"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="addFromDetail" class="btn">Add to cart</button>
        <button id="closeDetail" class="btn" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Close</button>
      </div>
    </div>
  </div>

<script>
/* ==== PRODUCT DATA (main) ==== */
const products = [
  {id:1, title:'Unicity Health Pack', price:129.99, img:'images/unicity.webp', desc:'Daily essentials to boost energy.'},
  {id:2, title:'Wishcare Skin Kit', price:39.99, img:'images/wishcare.webp', desc:'Glowing skin starter kit.'},
  {id:3, title:'4Life Transfer Factor', price:199.99, img:'images/4life.webp', desc:'Advanced wellness supplements.'},
  {id:4, title:'NIGHTFALL', price:29.99, img:'images/nightfall.jpg', desc:'Comfort wireless audio.'},
];

/* ==== STATIC New Products (same format as main) ==== */
const staticNewProducts = [
  {id:101, title: 'Herbal Nutrition Pack', price: 89.99, img: 'images/herballife.webp', desc: 'Boost immunity & daily wellness.'},
  {id:102, title: 'Skin Glow Advance Kit', price: 49.99, img: 'images/skin.webp', desc: 'Premium skincare for glowing skin.'},
  {id:103, title: 'Bare Hair Growth Spray', price: 159.99, img: 'images/bare.avif', desc: 'The Bare Anatomy Nature X Science Rosemary Water Spray promotes hair growth and thickness while helping control hair fall.'},
];

let newProducts = []; // user-added products (persisted)

/* ===== DOM nodes ===== */
const grid = document.getElementById('productGrid');
const newGrid = document.getElementById('newGrid');
const staticNewGrid = document.getElementById('staticNewGrid');
const featuredImg = document.getElementById('featuredImg');
const dotsWrap = document.getElementById('dots');
const countdownEl = document.getElementById('countdown');
const flash = document.getElementById('flash');
const pauseBtn = document.getElementById('pauseBtn');
const shopNow = document.getElementById('shopNow');

const cartCount = document.getElementById('cartCount');
const cartBackdrop = document.getElementById('cartBackdrop');
const cartItemsEl = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
const openCartBtn = document.getElementById('openCartBtn');
const closeCartBtn = document.getElementById('closeCart');
const checkoutBtn = document.getElementById('checkoutBtn');

const detailBackdrop = document.getElementById('detailBackdrop');
const detailImg = document.getElementById('detailImg');
const detailTitle = document.getElementById('detailTitle');
const detailPrice = document.getElementById('detailPrice');
const detailDesc = document.getElementById('detailDesc');
const addFromDetail = document.getElementById('addFromDetail');
const closeDetail = document.getElementById('closeDetail');

const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');

const newTitle = document.getElementById('newTitle');
const newPrice = document.getElementById('newPrice');
const newImg = document.getElementById('newImg');
const newShort = document.getElementById('newShort');
const newDesc = document.getElementById('newDesc');
const addNewBtn = document.getElementById('addNewBtn');
const clearNewBtn = document.getElementById('clearNewBtn');

const errTitle = document.getElementById('errTitle');
const errPrice = document.getElementById('errPrice');
const errImg = document.getElementById('errImg');
const errShort = document.getElementById('errShort');
const errDesc = document.getElementById('errDesc');

/* ===== STATE ===== */
let cart = {}; // simple in-memory cart 
let featuredIndex = 0;
let featuredInterval = null;
let featuredPaused = false;
const featuredIntervalMs = 3500;
let timeLeft = 120; // seconds for countdown

/* ===== HELPERS ===== */
function formatCurrency(n){ return '$' + Number(n).toFixed(2); }
function saveCart(){ localStorage.setItem('amazino_cart', JSON.stringify(cart)); }
function loadCart(){ const s = localStorage.getItem('amazino_cart'); if(s) cart = JSON.parse(s); updateCartUI(); }

function saveNewProducts(){ localStorage.setItem('amazino_new_products', JSON.stringify(newProducts)); }
function loadNewProducts(){ const s = localStorage.getItem('amazino_new_products'); if(s){ newProducts = JSON.parse(s); } else { newProducts = []; } }

/* ===== RENDER MAIN GRID ===== */
function renderGrid(list = products){
  grid.innerHTML = '';
  list.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.img}" alt="${p.title}" data-id="${p.id}">
      <div class="title" data-id="${p.id}">${p.title}</div>
      <div class="desc">${p.desc}</div>
      <div class="price">${formatCurrency(p.price)}</div>
      <div class="meta">
        <div style="color:var(--muted)"></div>
        <div><button class="btn" data-add="${p.id}">Add</button></div>
      </div>
    `;
    grid.appendChild(card);
  });

  // Attach listeners AFTER nodes exist
  grid.querySelectorAll('[data-add]').forEach(btn=>{
    btn.addEventListener('click', ()=> addToCart(+btn.getAttribute('data-add')));
  });
  // Image/title click → open detail and set image properly
  grid.querySelectorAll('img[data-id], .title[data-id]').forEach(el=>{
    el.style.cursor = 'pointer';
    el.addEventListener('click', ()=> {
      const id = +el.getAttribute('data-id');
      openDetail(id);
    });
  });
}

/* ===== RENDER STATIC NEW PRODUCTS ===== */
function renderStaticNewProducts(){
  staticNewGrid.innerHTML = '';
  staticNewProducts.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.img}" alt="${p.title}" data-staticid="${p.id}">
      <div class="title" data-staticid="${p.id}">${p.title}</div>
      <div class="desc">${p.desc}</div>
      <div class="price">${formatCurrency(p.price)}</div>
      <div class="meta">
        <div style="color:var(--muted)"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" data-addstatic="${p.id}">Add</button>
          <button class="btn" data-movetomainstatic="${p.id}" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Move to Main</button>
        </div>
      </div>
    `;
    staticNewGrid.appendChild(card);
  });

  // listeners
  staticNewGrid.querySelectorAll('[data-addstatic]').forEach(b=> b.addEventListener('click', ()=> {
    const id = +b.getAttribute('data-addstatic');
    const p = staticNewProducts.find(x=> x.id === id);
    if(p) addStaticToCart(p);
  }));
  staticNewGrid.querySelectorAll('[data-movetomainstatic]').forEach(b=> b.addEventListener('click', ()=> {
    const id = +b.getAttribute('data-movetomainstatic');
    const idx = staticNewProducts.findIndex(x=> x.id === id);
    if(idx !== -1){
      const p = staticNewProducts[idx];
      const newId = products.length ? Math.max(...products.map(x=>x.id)) + 1 : 1;
      products.push({id:newId, title:p.title, price: p.price, img: p.img, desc: p.desc});
      renderGrid();
      renderDots();
      alert('Moved "'+p.title+'" to main products');
    }
  }));
  staticNewGrid.querySelectorAll('img[data-staticid], .title[data-staticid]').forEach(el=>{
    el.style.cursor = 'pointer';
    el.addEventListener('click', ()=> {
      const id = +el.getAttribute('data-staticid');
      const p = staticNewProducts.find(x=> x.id === id);
      if(p) openDetailStatic(p);
    });
  });
}

function addStaticToCart(p){
  const id = 's' + p.id; // string id for static items in cart
  if(!cart[id]) cart[id] = {...p, qty:0};
  cart[id].qty += 1;
  saveCart();
  updateCartUI();
  alert('Added "'+p.title+'" to cart');
}

function openDetailStatic(p){
  detailTitle.textContent = p.title;
  detailPrice.textContent = formatCurrency(p.price);
  detailDesc.textContent = p.desc;
  detailImg.setAttribute('src', p.img);
  detailImg.setAttribute('alt', p.title);
  detailBackdrop.style.display = 'flex';
  detailBackdrop.setAttribute('aria-hidden','false');
  currentDetailId = null; // indicates not a main product
}

/* ===== RENDER NEW (user) PRODUCTS ===== */
function renderNewProducts(){
  newGrid.innerHTML = '';
  if(newProducts.length === 0){ newGrid.innerHTML = '<div style="color:var(--muted);padding:12px">No new products yet — add one above.</div>'; return; }
  newProducts.forEach((p, idx)=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.img || 'https://via.placeholder.com/400x300?text=No+Image'}" alt="${p.title}" data-newid="${idx}">
      <div class="title" data-newid="${idx}">${p.title}</div>
      <div class="desc">${p.desc || p.short}</div>
      <div class="price">${formatCurrency(Number(p.price) || 0)}</div>
      <div class="meta">
        <div style="color:var(--muted)"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" data-addnew="${idx}">Add to Cart</button>
          <button class="btn" data-movemain="${idx}" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Move to Main</button>
          <button class="btn" data-removenew="${idx}" style="background:transparent;border:1px solid #ddd;color:var(--muted)">Remove</button>
        </div>
      </div>
    `;
    newGrid.appendChild(card);
  });

  // Attach listeners
  newGrid.querySelectorAll('[data-addnew]').forEach(b=> b.addEventListener('click', ()=> {
    const idx = +b.getAttribute('data-addnew');
    addNewProductToCart(idx);
  }));
  newGrid.querySelectorAll('[data-movemain]').forEach(b=> b.addEventListener('click', ()=> {
    const idx = +b.getAttribute('data-movemain');
    moveToMain(idx);
  }));
  newGrid.querySelectorAll('[data-removenew]').forEach(b=> b.addEventListener('click', ()=> {
    const idx = +b.getAttribute('data-removenew');
    if(confirm('Remove this new product?')){ newProducts.splice(idx,1); saveNewProducts(); renderNewProducts(); }
  }));
  newGrid.querySelectorAll('img[data-newid], .title[data-newid]').forEach(el=>{
    el.style.cursor = 'pointer';
    el.addEventListener('click', ()=> {
      const idx = +el.getAttribute('data-newid');
      openDetailNew(idx);
    });
  });
}

/* ===== FEATURED CAROUSEL (images always update) ===== */
function setFeatured(i){
  featuredIndex = i % products.length;
  const p = products[featuredIndex];
  featuredImg.setAttribute('src', p.img);
  featuredImg.setAttribute('alt', p.title);
  Array.from(dotsWrap.children).forEach((d, idx)=> d.classList.toggle('active', idx === featuredIndex));
}

function renderDots(){
  dotsWrap.innerHTML = '';
  const count = Math.min(products.length, 6);
  for(let i=0;i<count;i++){
    const d = document.createElement('button');
    d.className = 'dot' + (i===featuredIndex ? ' active' : '');
    d.setAttribute('aria-label','Show slide '+(i+1));
    d.addEventListener('click', ()=> { setFeatured(i); pauseFeatured(true); });
    dotsWrap.appendChild(d);
  }
}

function startFeatured(){
  if(featuredInterval) clearInterval(featuredInterval);
  featuredInterval = setInterval(()=> {
    if(!featuredPaused){
      setFeatured((featuredIndex + 1) % products.length);
    }
  }, featuredIntervalMs);
}

function pauseFeatured(pause = true){
  featuredPaused = pause;
  pauseBtn.textContent = pause ? 'Resume' : 'Pause';
}

/* ===== PRODUCT DETAIL ===== */
let currentDetailId = null;
function openDetail(id){
  const p = products.find(x=>x.id===id);
  if(!p) return;
  currentDetailId = id;
  detailTitle.textContent = p.title;
  detailPrice.textContent = formatCurrency(p.price);
  detailDesc.textContent = p.desc;
  detailImg.setAttribute('src', p.img);
  detailImg.setAttribute('alt', p.title);
  detailBackdrop.style.display = 'flex';
  detailBackdrop.setAttribute('aria-hidden','false');
}
function openDetailNew(idx){
  const p = newProducts[idx];
  if(!p) return;
  currentDetailId = null; // indicates it's a new product
  detailTitle.textContent = p.title;
  detailPrice.textContent = formatCurrency(Number(p.price) || 0);
  detailDesc.textContent = p.desc || p.short;
  detailImg.setAttribute('src', p.img || 'https://via.placeholder.com/800x600?text=No+Image');
  detailImg.setAttribute('alt', p.title);
  detailBackdrop.style.display = 'flex';
  detailBackdrop.setAttribute('aria-hidden','false');
}

function closeDetailModal(){
  detailBackdrop.style.display = 'none';
  detailBackdrop.setAttribute('aria-hidden','true');
  currentDetailId = null;
}

/* ===== CART FUNCTIONS ===== */
function addToCart(id, qty = 1){
  const p = products.find(x=>x.id===id);
  if(!p) return;
  if(!cart[id]) cart[id] = {...p, qty:0};
  cart[id].qty += qty;
  saveCart();
  updateCartUI();
  const btn = document.querySelector(`[data-add="${id}"]`);
  if(btn){
    const prev = btn.textContent;
    btn.textContent = 'Added ✓';
    setTimeout(()=> btn.textContent = prev, 900);
  }
}
function addNewProductToCart(idx){
  const p = newProducts[idx];
  if(!p) return;
  const id = 'n' + Date.now() + '_' + idx;
  cart[id] = {...p, qty:1};
  saveCart();
  updateCartUI();
  alert('Added "' + p.title + '" to cart');
}
function moveToMain(idx){
  const p = newProducts[idx];
  if(!p) return;
  const newId = products.length ? Math.max(...products.map(x=>x.id)) + 1 : 1;
  products.push({id:newId, title:p.title, price: Number(p.price) || 0, img: p.img || 'https://via.placeholder.com/400x300?text=No+Image', desc: p.desc || p.short || ''});
  newProducts.splice(idx,1);
  saveNewProducts();
  renderGrid();
  renderNewProducts();
  renderDots();
}
function changeQty(id, delta){
  if(!cart[id]) return;
  cart[id].qty += delta;
  if(cart[id].qty <= 0) delete cart[id];
  saveCart();
  updateCartUI();
}
function updateCartUI(){
  const qty = Object.values(cart).reduce((s,it)=> s + it.qty, 0);
  cartCount.textContent = qty;
  cartItemsEl.innerHTML = '';
  if(qty === 0){
    cartItemsEl.innerHTML = '<div style="color:var(--muted)">Your cart is empty</div>';
    cartTotalEl.textContent = 'Total: $0.00';
    return;
  }
  let total = 0;
  Object.values(cart).forEach(item=>{
    total += item.qty * item.price;
    const row = document.createElement('div');
    row.style.display = 'flex'; row.style.gap='12px'; row.style.alignItems='center'; row.style.marginBottom='10px';
    row.innerHTML = `
      <img src="${item.img}" alt="${item.title}" style="width:64px;height:64px;object-fit:cover;border-radius:8px">
      <div style="flex:1"><strong>${item.title}</strong><div style="color:var(--muted)">${item.qty} × ${formatCurrency(item.price)}</div></div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <div style="font-weight:800">${formatCurrency(item.qty*item.price)}</div>
        <div style="display:flex;gap:6px">
          <button class="btn" data-dec="${item.id}" style="background:transparent;border:1px solid #ddd;color:var(--muted)">−</button>
          <button class="btn" data-inc="${item.id}" style="background:transparent;border:1px solid #ddd;color:var(--muted)">+</button>
        </div>
      </div>
    `;
    cartItemsEl.appendChild(row);
  });
  cartTotalEl.textContent = 'Total: ' + formatCurrency(total);
  // attach dec/inc
  cartItemsEl.querySelectorAll('[data-dec]').forEach(b=> b.addEventListener('click', ()=> changeQty(+b.getAttribute('data-dec'), -1)));
  cartItemsEl.querySelectorAll('[data-inc]').forEach(b=> b.addEventListener('click', ()=> changeQty(+b.getAttribute('data-inc'), +1)));
}

/* ===== COUNTDOWN ===== */
function startCountdown(){
  countdownEl.textContent = formatTime(timeLeft);
  const t = setInterval(()=> {
    if(timeLeft > 0) timeLeft--;
    countdownEl.textContent = formatTime(timeLeft);
    if(timeLeft === 0) { clearInterval(t); document.getElementById('dealTitle').textContent = 'Deal ended'; }
  }, 1000);
}
function formatTime(s){ const m = String(Math.floor(s/60)).padStart(2,'0'); const sec = String(s%60).padStart(2,'0'); return `${m}:${sec}`; }

/* ===== SEARCH ===== */
function doSearch(q){
  q = (q||'').trim().toLowerCase();
  if(!q) return renderGrid(products);
  const filtered = products.filter(p => (p.title + ' ' + p.desc).toLowerCase().includes(q));
  renderGrid(filtered);
}

/* ===== NEW PRODUCT VALIDATION LOGIC ===== */

// Simple URL / image URL validation (does not fetch)
function isValidUrl(str){
  try {
    const u = new URL(str);
    // allow http/https only
    if(u.protocol !== 'http:' && u.protocol !== 'https:') return false;
    return true;
  } catch(e){
    return false;
  }
}
function looksLikeImageUrl(url){
  if(!isValidUrl(url)) return false;
  return /\.(jpg|jpeg|png|gif|webp|avif|svg)(\?.*)?$/i.test(url);
}

function validateNewForm(){
  let valid = true;

  // Title (required)
  const title = (newTitle.value || '').trim();
  if(!title){
    setError(newTitle, errTitle, 'Title is required');
    valid = false;
  } else if(title.length > 120){
    setError(newTitle, errTitle, 'Title too long (max 120 chars)');
    valid = false;
  } else {
    clearError(newTitle, errTitle);
  }

  // Price (required, >= 0)
  const priceRaw = (newPrice.value || '').trim();
  const priceNum = Number(priceRaw);
  if(priceRaw === ''){
    setError(newPrice, errPrice, 'Price is required (use 0 if free)');
    valid = false;
  } else if(Number.isNaN(priceNum)){
    setError(newPrice, errPrice, 'Price must be a number');
    valid = false;
  } else if(priceNum < 0){
    setError(newPrice, errPrice, 'Price cannot be negative');
    valid = false;
  } else {
    clearError(newPrice, errPrice);
  }

  // Image URL (optional but if present must be valid URL; prefer image URL)
  const imgVal = (newImg.value || '').trim();
  if(imgVal){
    if(!isValidUrl(imgVal)){
      setError(newImg, errImg, 'Invalid URL (must start with http/https)');
      valid = false;
    } else if(!looksLikeImageUrl(imgVal)){
      // not strictly invalid — just warn but allow
      setError(newImg, errImg, 'URL looks valid but not a typical image file (jpg/png/webp). If correct, you can ignore this.');
      // *do not* set valid=false here — allow image URLs that are CDN endpoints without file ext
    } else {
      clearError(newImg, errImg);
    }
  } else {
    clearError(newImg, errImg);
  }

  // Short desc (optional, limit 80 chars)
  const shortVal = (newShort.value || '').trim();
  if(shortVal && shortVal.length > 80){
    setError(newShort, errShort, 'Short description max 80 characters');
    valid = false;
  } else {
    clearError(newShort, errShort);
  }

  // Long desc (optional, limit 1000 chars)
  const descVal = (newDesc.value || '').trim();
  if(descVal && descVal.length > 1000){
    setError(newDesc, errDesc, 'Description too long (max 1000 chars)');
    valid = false;
  } else {
    clearError(newDesc, errDesc);
  }

  addNewBtn.disabled = !valid;
  return valid;
}

function setError(inputEl, errEl, msg){
  errEl.textContent = msg || '';
  inputEl.parentElement.classList.add('has-error');
}
function clearError(inputEl, errEl){
  errEl.textContent = '';
  inputEl.parentElement.classList.remove('has-error');
}

// Hook validation to inputs (live-feedback)
[newTitle, newPrice, newImg, newShort, newDesc].forEach(el=>{
  el.addEventListener('input', () => validateNewForm());
  el.addEventListener('blur', () => validateNewForm());
});

/* ===== NEW PRODUCT HANDLERS ===== */
function clearNewForm(){ newTitle.value=''; newPrice.value=''; newImg.value=''; newShort.value=''; newDesc.value=''; validateNewForm(); }
function addNewProductFromForm(){
  if(!validateNewForm()){
    // focus first error
    const firstErr = document.querySelector('.has-error input, .has-error textarea');
    if(firstErr) firstErr.focus();
    return;
  }
  const title = (newTitle.value||'').trim();
  const price = (newPrice.value||'').trim();
  const img = (newImg.value||'').trim();
  const short = (newShort.value||'').trim();
  const desc = (newDesc.value||'').trim();
  const p = { title, price: Number(price) || 0, img: img || 'https://via.placeholder.com/400x300?text=No+Image', short, desc };
  newProducts.unshift(p); // newest first
  saveNewProducts();
  renderNewProducts();
  clearNewForm();
  // slight UI feedback
  addNewBtn.textContent = 'Added ✓';
  addNewBtn.disabled = true;
  setTimeout(()=> { addNewBtn.textContent = 'Add to New Products'; }, 900);
}

/* ===== INIT ===== */
function init(){
  // load persisted newProducts (user) — if none found, we keep it empty
  loadNewProducts();
  renderGrid();
  renderDots();
  startFeatured();
  startCountdown();
  setTimeout(()=> { flash.style.display = 'block'; setTimeout(()=> flash.style.display = 'none', 6000); }, 5000);
  loadCart();
  renderNewProducts();
  // render static new products (the same format as main products)
  renderStaticNewProducts();

  // initial validation call (set button state)
  validateNewForm();
}

// featured control
pauseBtn.addEventListener('click', ()=> pauseFeatured(!featuredPaused));
shopNow.addEventListener('click', ()=> { addToCart(products[featuredIndex].id, 1); cartBackdrop.style.display = 'flex'; cartBackdrop.setAttribute('aria-hidden','false'); });

// hover pause
document.querySelector('.thumb').addEventListener('mouseenter', ()=> pauseFeatured(true));
document.querySelector('.thumb').addEventListener('mouseleave', ()=> pauseFeatured(false));

// cart modal
openCartBtn.addEventListener('click', ()=> { cartBackdrop.style.display='flex'; cartBackdrop.setAttribute('aria-hidden','false'); });
closeCartBtn.addEventListener('click', ()=> { cartBackdrop.style.display='none'; cartBackdrop.setAttribute('aria-hidden','true'); });
checkoutBtn.addEventListener('click', ()=> { if(Object.keys(cart).length===0){ alert('Cart is empty'); return; } alert('Checkout demo — total: ' + cartTotal()); cart = {}; saveCart(); updateCartUI(); cartBackdrop.style.display='none'; });

function cartTotal(){ return Object.values(cart).reduce((s,it)=> s + it.qty * it.price, 0); }

// detail modal
addFromDetail.addEventListener('click', ()=> { if(currentDetailId) addToCart(currentDetailId, 1); else alert('Use the Add to Cart button on new items to add them.'); closeDetailModal(); cartBackdrop.style.display='flex'; cartBackdrop.setAttribute('aria-hidden','false'); });
closeDetail.addEventListener('click', closeDetailModal);

// backdrop clicks to close
cartBackdrop.addEventListener('click', (e)=> { if(e.target === cartBackdrop) { cartBackdrop.style.display='none'; cartBackdrop.setAttribute('aria-hidden','true'); } });
detailBackdrop.addEventListener('click', (e)=> { if(e.target === detailBackdrop) { closeDetailModal(); } });

// search
searchBtn.addEventListener('click', ()=> doSearch(searchInput.value));
searchInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') doSearch(searchInput.value); });

// keyboard
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'Escape'){
      if(cartBackdrop.style.display === 'flex'){ cartBackdrop.style.display='none'; cartBackdrop.setAttribute('aria-hidden','true'); }
      if(detailBackdrop.style.display === 'flex'){ closeDetailModal(); }
    }
  });

// new product form events
addNewBtn.addEventListener('click', addNewProductFromForm);
clearNewBtn.addEventListener('click', clearNewForm);

window.addEventListener('beforeunload', saveCart);

init();
</script>
</body>
</html>
